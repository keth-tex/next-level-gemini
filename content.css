/* ==========================================================================
   1. VARIABLES & THEME CONFIGURATION
   Central definition of all design tokens to facilitate maintenance.
   ========================================================================== */
:root {
  /* --- Colors --- */
  --gemini-bg-item:               #333;
  --gemini-bg-item-hover:         #131314;
  --gemini-bg-item-active:        rgb(31, 55, 96);
  --gemini-bg-surface:            var(--gem-sys-color--surface-container, #1e1f20);
  --gemini-bg-actions:            #1e1f20;
  
  /* Drag & Drop Colors */
  --gemini-bg-dnd-chat:           rgb(82, 83, 83);

  /* Text Colors */
  /*--gemini-text-primary:          #dde2e9; /* Brighter, used for Headers/Folders */
  --gemini-text-primary:          var(--gem-sys-color--on-surface-variant); /* Brighter, used for Headers/Folders */
  /* --gemini-text-variant:          var(--gem-sys-color--on-surface-variant); /* Muted, used for Buttons/Items */
  --gemini-text-variant:          rgb(196, 199, 197); /* Muted, used for Buttons/Items */
  --gemini-text-selected:         rgb(223, 231, 245); /* var(--sidenav-button-selected-text-color); */
  --gemini-text-disabled:         #5f6368;

  /* --- Dimensions --- */
  --gemini-item-height:           40px;
  --gemini-radius:                8px;
  --gemini-icon-size:             20px;
  
  /* --- Layout & State --- */
  --gemini-toc-width:             308px; /* Updated via JS */
  --gemini-sidenav-diff:          236px;
  --gemini-switcher-offset:       var(--gemini-sidenav-diff);
  --gemini-current-sidebar-width: var(--bard-sidenav-open-width, 308px);
  --gemini-toc-effective-width:   var(--gemini-toc-width);

  /* --- Z-Indices --- */
  --gemini-z-actions:             10;
  --gemini-z-toc:                 90;
  --gemini-z-resizer:             99;
  
  /* --- Scrollbar --- */
  --gemini-scrollbar-hover:       rgb(68, 71, 70);
  --gemini-scrollbar-active:      rgb(68, 71, 70);
}

/* State Adjustments for CSS Variables */
body:has(.sidenav-with-history-container.collapsed) {
  --gemini-switcher-offset: 0px;
  --gemini-current-sidebar-width: var(--bard-sidenav-closed-width, 72px);
}

body.gemini-toc-closed {
  --gemini-toc-effective-width: 0px;
}


/* ==========================================================================
   2. SHARED SIDEBAR ITEM STYLES
   Consolidates styling for:
   - "New Folder" Button
   - "TOC" Button
   - Folder Headers
   - TOC List Items
   ========================================================================== */

/* 2.1 Base appearance for all interactive sidebar items (CONTAINERS) */
.new-folder-button,
.gemini-toc-sidebar-btn,
.folder-header,
.gemini-toc-item {
  background-color: var(--gemini-bg-item) !important;
  border-radius: var(--gemini-radius) !important;
  color: var(--gemini-text-variant) !important;
  border: none !important;
  cursor: pointer;
  user-select: none;
  /* Ensure flex layout is default for all these items */
  display: flex !important;
  align-items: center !important;
  
  /* Apply font-family to container so inputs with 'font: inherit' pick it up */
  font-family: var(--mat-list-list-item-label-text-font) !important;
}

/* 2.2 Hover States */
.new-folder-button:hover,
.gemini-toc-sidebar-btn:hover,
.folder-header:hover,
.gemini-toc-item:hover {
  background-color: var(--gemini-bg-item-hover) !important;
}

/* 2.3 Kill Switch for Material Design Overlays (Gray Haze) */
.new-folder-button::before, .new-folder-button::after,
.gemini-toc-sidebar-btn::before, .gemini-toc-sidebar-btn::after {
  display: none !important;
  content: none !important;
}

/* 2.4 Text Styling - Group A: Buttons & List Items (Variant Color) */
.new-folder-button .mdc-list-item__primary-text,
.gemini-toc-sidebar-btn .mdc-list-item__primary-text,
.gemini-toc-item .mdc-list-item__primary-text {
  color: var(--gemini-text-variant) !important;
  font-weight: 400 !important;
}

/* 2.5 Text Styling - Group B: Headers & Folders (Primary Color) */
.folder-name,
.gemini-toc-header {
  color: var(--gemini-text-primary) !important;
  font-weight: 500 !important;
}

/* 2.6 Icon Styling consistency */
.new-folder-button .mat-icon,
.gemini-toc-sidebar-btn .mat-icon,
.folder-header mat-icon {
  color: var(--gemini-text-variant) !important;
  height: var(--gemini-icon-size) !important;
  width: var(--gemini-icon-size) !important;
  font-size: var(--gemini-icon-size) !important;
}


/* ==========================================================================
   3. SPECIFIC COMPONENT ADJUSTMENTS
   Overrides and specific layout rules for the shared components above.
   ========================================================================== */

/* 3.1 Sidebar Action Buttons (New Folder & TOC) */
.new-folder-button,
.gemini-toc-sidebar-btn {
  height: var(--gemini-item-height) !important;
  width: 100% !important;
  margin: 0 !important;
}

/* Specific Font Size for Buttons */
.new-folder-button .mdc-list-item__primary-text,
.gemini-toc-sidebar-btn .mdc-list-item__primary-text {
  font-size: 14px !important;
}

/* Icon Containers in Buttons */
.new-folder-button .icon-container,
.gemini-toc-sidebar-btn .icon-container {
  margin-left: 14px !important;
  margin-right: 16px !important;
  width: var(--gemini-icon-size) !important;
  display: flex !important;
  align-items: center !important;
  justify-content: center !important;
}

/* 3.2 Folder Headers */
.folder-header {
  padding: 12px 16px 12px 0;
  /* gap: 8px; */
  margin-top: 12px;
  margin-bottom: 6px;
  position: relative; /* Context for actions menu */
}

.folder-name {
  position: relative;
  top: 1px;
  flex-grow: 1;
  font-size: var(--mat-list-list-item-label-text-size) !important;
}

/* Folder Arrow Animation */
.folder-header .folder-toggle-icon {
  margin-left: 14px;
  margin-right: 16px;
  transition: transform 0.3s ease !important;
  transform-origin: center !important;
}

.folder-header.is-open .folder-toggle-icon {
  transform: rotate(90deg) !important;
}

/* 3.3 TOC Items */
.gemini-toc-item {
  height: auto !important;
  min-height: var(--gemini-item-height) !important;
  margin: 0 0 18px 0 !important;
  padding: 8px 12px !important;
  box-sizing: border-box !important;
  align-items: flex-start !important; /* Multiline text alignment */
  white-space: normal !important;
  text-align: left;
}

.gemini-toc-item .mdc-list-item__primary-text {
  white-space: pre-wrap !important;
  overflow: visible !important;
  /* line-height: 1.4 !important; */
}

/* TOC Active State */
.gemini-toc-item.active,
.gemini-toc-item.active .mdc-list-item__primary-text {
  background-color: var(--gemini-bg-item-active) !important;
  color: var(--gemini-text-selected) !important;
}


/* ==========================================================================
   4. LAYOUT, SPACING & MARGINS
   ========================================================================== */

.overflow-container > mat-action-list > :first-child { /*.explore-gems-container*/
  margin-bottom: 18px !important;
}

.overflow-container > mat-action-list > :nth-child(2) { /*.explore-gems-container*/
  margin-bottom: 24px !important;
}

#new-folder-button,
#gemini-toc-toggle-button {
  margin-left: 12px !important;
  width: calc(100% - 24px) !important;
}

/* Native Element Tweaks */
.user-query-bubble-with-background {
  /* padding: 24px 30px 23px 34px !important; */
  padding: 24px 32px !important;
}

input-area-v2 { border-radius: 24px !important; }

.text-input-field { padding: 18px 24px !important; }

.explore-gems-container button {
  width: calc(100% - 14px) !important;
  margin-right: 2px !important;
}

location-footer { max-width: 428px !important; }

/* Global Border Radius Consistency */
.conversation, .mat-mdc-list-item, .pending-conversation-animation {
  border-radius: var(--gemini-radius) !important;
}


/* ==========================================================================
   5. RESIZERS (SIDEBAR & TOC)
   ========================================================================== */

#gemini-sidebar-resizer, 
#gemini-toc-resizer {
  position: absolute;
  top: 0; right: -50px; bottom: 0;
  width: 50px;
  z-index: var(--gemini-z-resizer);
  cursor: default;
}

@keyframes change-cursor {
  from { cursor: default; } to { cursor: col-resize; }
}

#gemini-sidebar-resizer:hover, 
#gemini-toc-resizer:hover {
  animation: change-cursor 0s linear 250ms forwards;
}

/* Shared Gripper Visuals */
#gemini-sidebar-resizer::before, 
#gemini-toc-resizer::before {
  content: '';
  position: absolute;
  top: 0; left: 0; right: 0; bottom: 0;
  background-image: linear-gradient(to right, rgba(255, 255, 255, .1), rgba(255, 255, 255, .05)),
                    url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 12 10' width='12' height='10'%3E%3Cpolygon points='5,0 0,5 5,10' fill='%23666'/%3E%3Cpolygon points='7,0 12,5 7,10' fill='%23666'/%3E%3C/svg%3E");
  background-size: auto, 24px 20px;
  background-position: center;
  background-repeat: no-repeat;
  opacity: 0;
  transition: opacity 500ms ease 0s;
}

#gemini-sidebar-resizer:hover::before, 
#gemini-toc-resizer:hover::before {
  opacity: 1;
  transition: opacity 500ms ease 250ms;
}

/* Global Resizing State (Cursor Locking) */
.gemini-resizing body, .gemini-resizing body * {
  user-select: none !important;
  cursor: col-resize !important;
}

.gemini-resizing iframe, .gemini-resizing button, .gemini-resizing a {
  pointer-events: none !important;
}

mat-drawer.mat-drawer-opened { transition: none !important; }


/* ==========================================================================
   6. TABLE OF CONTENTS (CONTAINER & LAYOUT)
   ========================================================================== */

#gemini-toc-container {
  width: var(--gemini-toc-width);
  min-width: 0px;
  flex-shrink: 0;
  position: relative;
  height: 100%;
  display: flex;
  flex-direction: column;
  overflow: visible !important;
  box-sizing: border-box;
  z-index: var(--gemini-z-toc) !important;
  background-color: var(--gemini-bg-surface);
  transition: width 300ms cubic-bezier(0.2, 0, 0, 1);
  border-right: 1px solid transparent;
}

#gemini-toc-container.collapsed {
  width: 0px !important;
}

/* Mask for Sliding Door Effect */
.gemini-toc-mask {
  flex-grow: 1;
  display: flex;
  flex-direction: column;
  width: 100% !important;
  height: 100%;
  overflow: hidden !important;
  box-sizing: border-box;
}

/* Force children to keep width during collapse */
.gemini-toc-mask > * {
  width: var(--gemini-toc-width, 308px) !important;
  min-width: var(--gemini-toc-width, 308px) !important;
  box-sizing: border-box !important;
}

.gemini-toc-header {
  padding: 12px 16px 24px 24px;
  margin-top: 15px;
  background-color: transparent;
  overflow: hidden;
  white-space: nowrap;
  text-overflow: ellipsis;
  font-family: var(--mat-list-list-item-label-text-font) !important;
  font-size: var(--mat-list-list-item-label-text-size) !important;
}

.gemini-toc-list {
  padding: 0 2px 0 12px !important;
  margin: 0;
  overflow-y: scroll;
  overflow-x: hidden;
  flex-grow: 1;
  display: block;
}


/* ==========================================================================
   7. ANIMATIONS & DYNAMIC STATES
   ========================================================================== */

/* 7.1 Sidebar Collapse Animation (Hide Elements) */
.folder-header {
  transition: margin 300ms cubic-bezier(0.2, 0, 0, 1),
              padding 300ms cubic-bezier(0.2, 0, 0, 1),
              opacity 150ms cubic-bezier(0.4, 0.0, 1, 1);
  opacity: 1;
  overflow: hidden;
}

.sidenav-with-history-container.collapsed .folder-header {
  opacity: 0 !important;
  margin: 0 !important;
  padding: 0 !important;
  border: none !important;
  pointer-events: none !important;
}

/* Hide TOC Button Text when collapsed */
.sidenav-with-history-container.collapsed .new-folder-button .mdc-list-item__content
.sidenav-with-history-container.collapsed .gemini-toc-sidebar-btn .mdc-list-item__content {
  display: none !important;
}

/* 7.2 Collapsed Button Fixes */
.side-nav-action-collapsed-button { display: flex !important; margin-left: 18px !important; }

.side-nav-action-collapsed-button .xap-count-badge-container,
.side-nav-action-collapsed-button .icon-container,
.icon-container {
  display: flex !important; align-items: center !important; height: 27px !important; line-height: normal !important;
}

/* 7.3 Grid Animation (Chat List Roll-up) */
.conversation-items-container {
  display: grid;
  grid-template-rows: 1fr;
  transition: grid-template-rows 0.3s ease-out, opacity 0.2s ease-in-out 0.1s;
  opacity: 1;
  overflow: hidden;
}

.conversation-items-container > * {
  transition: opacity 0.2s ease-in-out, visibility 0.2s, height 0.3s ease-out, padding 0.3s ease-out, margin 0.3s ease-out;
  visibility: visible;
  opacity: 1;
  overflow: hidden;
  min-height: 0;
}

/* Collapsed State */
.conversation-items-container.chat-item-rolled-up {
  grid-template-rows: 0fr !important;
  opacity: 0 !important;
  pointer-events: none !important;
}

.conversation-items-container.chat-item-rolled-up > * {
  visibility: hidden !important; opacity: 0 !important; height: 0 !important; min-height: 0 !important; padding: 0 !important; margin: 0 !important;
}

/* 7.4 Global Transition Disabling (during DnD or Resize) */
.gemini-dnd-no-transition { transition: none !important; }

.gemini-resizing #gemini-toc-container,
.gemini-resizing .side-nav-menu-button bard-mode-switcher,
.gemini-resizing top-bar-actions {
  transition: none !important;
}

/* 7.5 Element Positioning (Switcher & Top Bar) */
.side-nav-menu-button bard-mode-switcher {
  transition: transform 300ms cubic-bezier(0.2, 0, 0, 1) !important;
  transform: translateX(calc(var(--gemini-switcher-offset) + var(--gemini-toc-effective-width))) !important;
  opacity: 1 !important; visibility: visible !important;
}

top-bar-actions {
  left: calc(var(--gemini-current-sidebar-width) + var(--gemini-toc-effective-width)) !important;
  transition: left 300ms cubic-bezier(0.2, 0, 0, 1) !important;
}


/* ==========================================================================
   8. DRAG & DROP VISUALS
   ========================================================================== */
.conversation-items-container.gemini-dragging { opacity: 0.5; }

.folder-header.gemini-drag-over,
.conversation-items-container.gemini-chat-drag-over {
  border: none !important; outline: none !important;
  background-color: var(--gemini-bg-dnd-chat) !important;
  border-radius: var(--gemini-radius) !important;
}

.gemini-chat-is-dragging .folder-header > *,
.gemini-chat-is-dragging .conversation-items-container > * {
  pointer-events: none !important;
}


/* ==========================================================================
   9. MISCELLANEOUS UI
   ========================================================================== */

/* Folder Actions (Context Menu) */
.folder-actions {
  position: absolute; right: 8px; top: 50%; transform: translateY(-50%);
  display: none; pointer-events: auto;
  background: var(--gemini-bg-actions);
  border-radius: 4px; z-index: var(--gemini-z-actions);
}

.folder-header:hover .folder-actions { display: flex; }

.folder-actions .action-btn {
  background: none; border: none; cursor: pointer; color: #bdc1c6;
  padding: 4px; margin: 0 2px; border-radius: 50%;
}

.folder-actions .action-btn:hover { background-color: rgba(255, 255, 255, .1); }

.folder-actions .action-btn:disabled { color: var(--gemini-text-disabled); cursor: not-allowed; }

/* Inline Edit Input */
.folder-name-input {
  position: relative;
  top: 1px;
  font: inherit; color: var(--gemini-text-selected); font-weight: 500;
  border: none; outline: none; background: transparent;
  padding: 0; margin: 0; flex-grow: 1; min-width: 0;
}

/* Export Button Tooltip */
#gemini-tex-export-button-wrapper { position: relative; }

.gemini-tex-tooltip {
  word-break: normal; overflow-wrap: anywhere;
  padding: 4px 8px; min-width: 40px; max-width: 200px;
  box-sizing: border-box; overflow: hidden; text-align: center;
  background-color: var(--mat-tooltip-container-color, var(--mat-sys-inverse-surface));
  color: var(--mat-tooltip-supporting-text-color, var(--mat-sys-inverse-on-surface));
  border-radius: var(--mat-tooltip-container-shape, var(--mat-sys-corner-extra-small));
  font-family: var(--mat-tooltip-supporting-text-font, var(--mat-sys-body-small-font));
  font-size: var(--mat-tooltip-supporting-text-size, var(--mat-sys-body-small-size));
  font-weight: var(--mat-tooltip-supporting-text-weight, var(--mat-sys-body-small-weight));
  position: absolute; top: 100%; left: 50%; margin-top: 10px;
  opacity: 0; visibility: hidden;
  transform: translateX(-50%) scale(0.8);
  transition: opacity 150ms cubic-bezier(0, 0, 0.2, 1), transform 150ms cubic-bezier(0, 0, 0.2, 1), visibility 150ms cubic-bezier(0, 0, 0.2, 1);
  pointer-events: none; white-space: nowrap;
}

#gemini-tex-export-button-wrapper:hover .gemini-tex-tooltip {
  opacity: 1; visibility: visible; transform: translateX(-50%) scale(1);
}

/* Custom Scrollbar */
@media (pointer: fine) {
  ::-webkit-scrollbar, ::-webkit-scrollbar-corner { height: 24px !important; width: 24px !important; }

  ::-webkit-scrollbar-thumb {
    background: content-box var(--gem-sys-color--surface-container-highest) !important;
    border: 2px solid transparent; border-radius: var(--gemini-radius) !important;
    min-height: 48px; min-width: 48px;
  }

  ::-webkit-scrollbar-thumb:hover {
    background: content-box var(--gemini-scrollbar-hover) !important; /* Oder eine andere, etwas hellere/dunklere Farbe */
    border: 2px solid transparent; 
  }

  ::-webkit-scrollbar-thumb:active {
    background: content-box var(--gemini-scrollbar-active) !important; 
    border: 2px solid transparent;
  }
}

@supports not (selector(::-webkit-scrollbar)) {
  * { scrollbar-width: auto !important; scrollbar-color: var(--gem-sys-color--surface-container-highest) transparent !important; }
}

.code-block-decoration {
    border-top-left-radius: var(--gemini-radius) !important;
    border-top-right-radius: var(--gemini-radius) !important;
}

.formatted-code-block-internal-container {
    border-bottom-left-radius: var(--gemini-radius) !important;
    border-bottom-right-radius: var(--gemini-radius) !important;
}

/* Inline Code in User Prompts */
.gemini-prompt-inline-code {
  font-size: var(--gem-sys-typography-type-scale--body-m-font-size);
  font-weight: var(--gem-sys-typography-type-scale--body-m-font-weight);
  letter-spacing: var(--gem-sys-typography-type-scale--body-m-font-tracking);
  line-height: var(--gem-sys-typography-type-scale--body-m-line-height);
  --gds-type-scale-default-wdth: var(--gem-sys-typography-type-scale--body-m-font-width);
  font-variation-settings: var(--gds-type-scale-default-wdth), var(--gds-type-scale-default-slnt), var(--gds-type-scale-default-rond);
  font-family: Google Sans Mono, monospace;
  color: var(--gem-sys-color--on-surface);
  /* background-color: var(--gem-sys-color--surface-container-highest); */
  background-color: rgba(255, 255, 255, .1);
  border-radius: 6px;
  padding: 1px 6px;
  /* font-family: 'Roboto Mono', monospace; /* Oder eine passende Monospace Font */
  /* background-color: var(--gemini-bg-item-hover, #1e1f20); /* Nutzt existierende Variable */
  /* color: var(--gemini-text-primary, #e3e3e3); */
  /* padding: 2px 6px; */
  /* font-size: 0.9em; */
  /* border: 1px solid rgba(255, 255, 255, 0.1); */
  /* white-space: pre-wrap; /* Zeilenumbrüche erhalten, falls nötig */
}

.gds-body-m .gemini-prompt-inline-code {
  font-size: 13px !important;
  border-radius: 5px !important;
  padding: 1px 5px !important;
  opacity: .8 !important;
}

.gemini-prompt-list {
  margin-top: var(--gem-sys-spacing--s) !important;
  margin-bottom: var(--gem-sys-spacing--l) !important;
  overflow-wrap: break-word !important;
}

ol.gemini-prompt-list {
  padding-inline-start: 1.75rem !important;
}

ul.gemini-prompt-list {
  padding-inline-start: 1.6875rem !important;
}

.gemini-prompt-list > li,
.gemini-prompt-list > li > p {
  margin: var(--gem-sys-spacing--s) 0 !important;
  padding-inline-start: var(--gem-sys-spacing--xs) !important;
}

.gemini-toc-item .gemini-prompt-list {
  margin-top: calc(var(--gem-sys-spacing--s) * .8) !important;
  margin-bottom: calc(var(--gem-sys-spacing--l) * .8) !important;
}

.gemini-toc-item ol.gemini-prompt-list {
  padding-inline-start: calc(1.75rem * .8) !important;
}

.gemini-toc-item ul.gemini-prompt-list {
  padding-inline-start: calc(1.6875rem * .8) !important;
}

.gemini-toc-item .gemini-prompt-list > li,
.gemini-toc-item .gemini-prompt-list > li > p {
  margin: calc(var(--gem-sys-spacing--s) * .8) 0 !important;
  padding-inline-start: calc(var(--gem-sys-spacing--xs) * .8) !important;
}

.gemini-prompt-list > li > ::marker {
  overflow-wrap: break-word !important;
}

/* Remove default margins from first/last elements to prevent layout shift */
.query-text > :first-child {
  margin-top: 0 !important;
  margin-block-start: 0 !important;
}

.query-text > :last-child {
  margin-bottom: 0 !important;
  margin-block-end: 0 !important;
}

/* Specific handling for lists at the start/end of prompt to ensure no margins on container OR items */
/* First List */
.gemini-prompt-list:first-child,
.gemini-prompt-list:first-child > li:first-child,
.gemini-prompt-list:first-child > li:first-child > p:first-child {
  margin-top: 0 !important;
  margin-block-start: 0 !important;
}

/* Last List */
.gemini-prompt-list:last-child,
.gemini-prompt-list:last-child > li:last-child,
.gemini-prompt-list:last-child > li:last-child > p:last-child {
  margin-bottom: 0 !important;
  margin-block-end: 0 !important;
}

/* Remove margin from paragraphs directly preceding a list to keep them grouped */
p.query-text-line:has(+ .gemini-prompt-list) {
  margin-bottom: 0 !important;
  margin-block-end: 0 !important;
}

.gemini-h1,
.gemini-h2,
.gemini-h3,
.gemini-h4,
.gemini-h5,
.gemini-h6 {
  margin: 1.75rem 0 var(--gem-sys-spacing--s) !important;
}

.gemini-h1 {
    font-size: var(--gem-sys-typography-markdown-type-scale--h-1-font-size) !important;
    font-weight: var(--gem-sys-typography-markdown-type-scale--h-1-font-weight) !important;
    letter-spacing: var(--gem-sys-typography-markdown-type-scale--h-1-font-tracking) !important;
    line-height: var(--gem-sys-typography-markdown-type-scale--h-1-line-height) !important;
    --gds-type-scale-default-wdth: var(--gem-sys-typography-markdown-type-scale--h-1-font-width) !important;
    font-variation-settings: var(--gds-type-scale-default-wdth), var(--gds-type-scale-default-slnt), var(--gds-type-scale-default-rond) !important;
}

.gemini-h2 {
    font-size: var(--gem-sys-typography-markdown-type-scale--h-2-font-size) !important;
    font-weight: var(--gem-sys-typography-markdown-type-scale--h-2-font-weight) !important;
    letter-spacing: var(--gem-sys-typography-markdown-type-scale--h-2-font-tracking) !important;
    line-height: var(--gem-sys-typography-markdown-type-scale--h-2-line-height) !important;
    --gds-type-scale-default-wdth: var(--gem-sys-typography-markdown-type-scale--h-2-font-width) !important;
    font-variation-settings: var(--gds-type-scale-default-wdth), var(--gds-type-scale-default-slnt), var(--gds-type-scale-default-rond) !important;
}

.gemini-h3 {
    font-size: var(--gem-sys-typography-markdown-type-scale--h-3-font-size) !important;
    font-weight: var(--gem-sys-typography-markdown-type-scale--h-3-font-weight) !important;
    letter-spacing: var(--gem-sys-typography-markdown-type-scale--h-3-font-tracking) !important;
    line-height: var(--gem-sys-typography-markdown-type-scale--h-3-line-height) !important;
    --gds-type-scale-default-wdth: var(--gem-sys-typography-markdown-type-scale--h-3-font-width) !important;
    font-variation-settings: var(--gds-type-scale-default-wdth), var(--gds-type-scale-default-slnt), var(--gds-type-scale-default-rond) !important;
}

.gemini-h4,
.gemini-h5,
.gemini-h6 {
  font-weight: var(--gem-sys-typography-markdown-type-scale--h-4-font-weight) !important;
  letter-spacing: var(--gem-sys-typography-markdown-type-scale--h-4-font-tracking) !important;
  line-height: var(--gem-sys-typography-markdown-type-scale--h-4-line-height) !important;
  --gds-type-scale-default-wdth: var(--gem-sys-typography-markdown-type-scale--h-4-font-width) !important;
  font-variation-settings: var(--gds-type-scale-default-wdth), var(--gds-type-scale-default-slnt), var(--gds-type-scale-default-rond) !important;
}

.gemini-h4 {
  font-size: var(--gem-sys-typography-markdown-type-scale--h-4-font-size) !important;
}

.gemini-h5 {
  font-size: var(--gem-sys-typography-markdown-type-scale--h-5-font-size) !important;
}

.gemini-h6 {
  font-size: var(--gem-sys-typography-markdown-type-scale--h-6-font-size) !important;
}

.gemini-prompt-hr {
    margin-top: 20px;
    margin-bottom: 25px;
}

/* --- GOOGLE GEMINI DARK SYNTAX HIGHLIGHTING (Refined) --- */

.query-text .formatted-code-block-internal-container,
.gemini-toc-item .formatted-code-block-internal-container {
  background-color: var(--gem-sys-color--surface-container);
  border-top-left-radius: 4px;
  border-top-right-radius: 4px;
}

.query-text .formatted-code-block-internal-container {
  margin-bottom: var(--gem-sys-spacing--xs) !important;
}

.gemini-toc-item .formatted-code-block-internal-container {
  margin-bottom: calc(var(--gem-sys-spacing--xs) * .8) !important;
}

/* Structural Styles (Scoped to .query-text) */
.query-text .code-block {
  width: 452px;
  /* background-color: var(--gemini-bg-surface); */
  margin-top: 16px;
  margin-bottom: 16px;
  overflow: hidden;
  border-radius: 8px !important;
  /* border: 1px solid rgba(255, 255, 255, 0.1); */
}

.query-text:has(+ button) .code-block {
    width: 412px !important;
}

/* Structural Styles (Scoped to .query-text) */
.gemini-toc-item .code-block {
  width: calc(var(--gemini-toc-effective-width) - 62px) !important;
  /* background-color: var(--gemini-bg-surface); */
  margin-top: 13px;
  margin-bottom: 13px;
  overflow: hidden;
  border-radius: 8px !important;
  /* border: 1px solid rgba(255, 255, 255, 0.1); */
}

.query-text .code-block-decoration {
  background-color: var(--gem-sys-color--surface-container);
  border-radius: var(--gem-sys-spacing--l) var(--gem-sys-spacing--l) var(--gem-sys-spacing--xs) var(--gem-sys-spacing--xs);
  -webkit-box-pack: justify;
  -moz-box-pack: justify;
  -ms-flex-pack: justify;
  justify-content: space-between;
  padding: var(--gem-sys-spacing--s) var(--gem-sys-spacing--s) var(--gem-sys-spacing--s) var(--gem-sys-spacing--l);
  margin-top: var(--gem-sys-spacing--xs);
  margin-bottom: 2px;
  height: 32px;
  color: var(--gem-sys-color--on-surface-variant);
  padding-inline-start: var(--gem-sys-spacing--l);
  min-height: var(--gem-sys-spacing--xxl);
  display: flex;
  -webkit-box-align: center;
  -moz-box-align: center;
  -ms-flex-align: center;
  align-items: center;
  top: -16px;
  z-index: 1;
  position: sticky;
  /* background-color: var(--gemini-bg-surface); */
  border-bottom-left-radius: 4px;
  border-bottom-right-radius: 4px;
  /* padding: 8px 16px;
  font-family: 'Google Sans', sans-serif;
  font-size: 0.85em;
  font-weight: 500;
  color: var(--gemini-text-variant);
  border-bottom: 1px solid rgba(255, 255, 255, 0.05);
  display: flex;
  align-items: center;
  min-height: 24px; */
}

.gemini-toc-item .code-block-decoration {
  background-color: var(--gem-sys-color--surface-container);
  border-radius: var(--gem-sys-spacing--l) var(--gem-sys-spacing--l) var(--gem-sys-spacing--xs) var(--gem-sys-spacing--xs);
  -webkit-box-pack: justify;
  -moz-box-pack: justify;
  -ms-flex-pack: justify;
  justify-content: space-between;
  padding: calc(var(--gem-sys-spacing--s) * .8) calc(var(--gem-sys-spacing--s) * .8) calc(var(--gem-sys-spacing--s) * .8) calc(var(--gem-sys-spacing--s) * .8);
  margin-top: calc(var(--gem-sys-spacing--xs) * .8);
  margin-bottom: 2px;
  height: 26px;
  color: var(--gem-sys-color--on-surface-variant);
  padding-inline-start: calc(var(--gem-sys-spacing--l) * .8);
  min-height: calc(var(--gem-sys-spacing--xxl) * .8);
  display: flex;
  -webkit-box-align: center;
  -moz-box-align: center;
  -ms-flex-align: center;
  align-items: center;
  top: -13px;
  z-index: 1;
  position: sticky;
  font-size: calc(var(--gem-sys-typography-type-scale--title-s-font-size) * .8) !important;
  letter-spacing: calc(var(--gem-sys-typography-type-scale--title-s-font-tracking) * .8) !important;
  line-height: calc(var(--gem-sys-typography-type-scale--title-s-line-height) * .8) !important;
  --gds-type-scale-default-wdth: calc(var(--gem-sys-typography-type-scale--title-s-font-width) * .8) !important;
  font-variation-settings: var(--gds-type-scale-default-wdth), var(--gds-type-scale-default-slnt), var(--gds-type-scale-default-rond) !important;
  /* background-color: var(--gemini-bg-surface); */
  border-bottom-left-radius: 4px;
  border-bottom-right-radius: 4px;
  /* padding: 8px 16px;
  font-family: 'Google Sans', sans-serif;
  font-size: 0.85em;
  font-weight: 500;
  color: var(--gemini-text-variant);
  border-bottom: 1px solid rgba(255, 255, 255, 0.05);
  display: flex;
  align-items: center;
  min-height: 24px; */
}

.query-text .formatted-code-block-internal-container pre,
.gemini-toc-item .formatted-code-block-internal-container pre {
  margin: 0;
  overflow: hidden;
}

.query-text .code-container,
.gemini-toc-item .code-container {
  color: var(--gem-sys-color--on-surface-variant); /* Standard Text */
  
  /* FIX: Enable horizontal scrolling only when needed and prevent wrapping */
  display: block;
  white-space: pre;
  overflow-x: auto;
}

.query-text .code-container {
  font: 400 .875rem / 1.3125rem Google Sans Code, monospace;
  padding: 16px; /* Padding moved here to scroll with content */
}

.gemini-toc-item .code-container {
  font: 400 calc(.875rem * .8) / calc(1.3125rem * .8) Google Sans Code, monospace;
  padding: 13px; /* Padding moved here to scroll with content */
}

/* --- GOOGLE GEMINI NATIVE SYNTAX HIGHLIGHTING (Variables) --- */

/* Kommentare */
.query-text .hljs-comment,
.gemini-toc-item .hljs-comment,
.query-text .hljs-quote,
.gemini-toc-item .hljs-quote {
  color: var(--bard-color-code-comment);
}

.query-text .hljs-quote,
.gemini-toc-item .hljs-quote {
  font-style: italic;
}

/* Variablen, HTML-Tags, CSS-Tags */
/* User Mapping: selector-tag -> Red (variables) */
.query-text .hljs-variable,
.gemini-toc-item .hljs-variable,
.query-text .hljs-template-variable,
.gemini-toc-item .hljs-template-variable,
.query-text .hljs-tag,
.gemini-toc-item .hljs-tag,
.query-text .hljs-name,
.gemini-toc-item .hljs-name,
.query-text .hljs-selector-tag, 
.gemini-toc-item .hljs-selector-tag, 
.query-text .hljs-deletion,
.gemini-toc-item .hljs-deletion {
  color: var(--bard-color-code-variables);
}

/* Keywords, CSS-Klassen, Selektoren */
/* User Mapping: selector-class -> Purple (keyword) */
.query-text .hljs-keyword,
.gemini-toc-item .hljs-keyword,
.query-text .hljs-selector-id,
.gemini-toc-item .hljs-selector-id,
.query-text .hljs-selector-class,
.gemini-toc-item .hljs-selector-class,
.query-text .hljs-selector-attr,
.gemini-toc-item .hljs-selector-attr,
.query-text .hljs-selector-pseudo,
.gemini-toc-item .hljs-selector-pseudo {
  color: var(--bard-color-code-keyword);
}

/* Strings, Symbole */
.query-text .hljs-string,
.gemini-toc-item .hljs-string,
.query-text .hljs-symbol,
.gemini-toc-item .hljs-symbol,
.query-text .hljs-bullet,
.gemini-toc-item .hljs-bullet,
.query-text .hljs-addition,
.gemini-toc-item .hljs-addition {
  color: var(--bard-color-code-string);
}

/* Zahlen, Literale, Konstanten */
/* User Mapping: number -> Orange (literal) */
.query-text .hljs-number,
.gemini-toc-item .hljs-number,
.query-text .hljs-literal,
.gemini-toc-item .hljs-literal,
.query-text .hljs-type,
.gemini-toc-item .hljs-type,
.query-text .hljs-params,
.gemini-toc-item .hljs-params {
  color: var(--bard-color-code-literal);
}

/* Klassen, Funktionen, Titel */
.query-text .hljs-title,
.gemini-toc-item .hljs-title,
.query-text .hljs-section,
.gemini-toc-item .hljs-section,
.query-text .hljs-class .hljs-title,
.gemini-toc-item .hljs-class .hljs-title {
  color: var(--bard-color-code-class);
}

/* Built-ins, Meta, Links */
/* User Mapping: meta -> Blue (quotes-and-meta) */
.query-text .hljs-built_in,
.gemini-toc-item .hljs-built_in,
.query-text .hljs-builtin-name,
.gemini-toc-item .hljs-builtin-name,
.query-text .hljs-meta,
.gemini-toc-item .hljs-meta,
.query-text .hljs-link,
.gemini-toc-item .hljs-link {
  color: var(--bard-color-code-quotes-and-meta);
}

/* Attribute */
/* User Mapping: attribute -> Light Gray.
   Da keine explizite Variable existiert, nutzen wir 'inherit',
   was auf die Standard-Textfarbe zurückfällt (meist hellgrau/weiß im Dark Mode). */
.query-text .hljs-attr,
.gemini-toc-item .hljs-attr,
.query-text .hljs-attribute,
.gemini-toc-item .hljs-attribute {
  color: inherit;
}

/* Fett / Kursiv */
.query-text .hljs-strong { font-weight: bold; }

.gemini-toc-item .hljs-strong { font-weight: bold; }

.query-text .hljs-emphasis { font-style: italic; }

.gemini-toc-item .hljs-emphasis { font-style: italic; }

.query-text .hljs-link,
.gemini-toc-item .hljs-link {
  text-decoration: underline;
}

/* --- TOC SPECIFIC CONTENT STYLES --- */
/* This allows us to style the markdown elements differently inside the sidebar */

.gemini-toc-content-wrapper pre {
  margin: 0 !important;
  overflow: hidden !important;
}

.gemini-toc-content-wrapper {
  /* font-size: 0.9em; /* Slightly smaller text in TOC */
  width: calc(var(--gemini-toc-effective-width) - 62px) !important;
  overflow: hidden !important;
  display: block !important;
  /* white-space: pre !important; */
  overflow-x: auto !important;
}

.gds-body-m .gemini-h1,
.gds-body-m .gemini-h2,
.gds-body-m .gemini-h3,
.gds-body-m .gemini-h4,
.gds-body-m .gemini-h5,
.gds-body-m .gemini-h6 {
  margin: calc(1.75rem * .8) 0 calc(var(--gem-sys-spacing--s) * .8) !important;
}

.gds-body-m .gemini-h1 {
    font-size: 18px !important ;
    font-weight: var(--gem-sys-typography-markdown-type-scale--h-1-font-weight) !important;
    letter-spacing: calc(var(--gem-sys-typography-markdown-type-scale--h-1-font-tracking) * .8) !important;
    line-height: calc(var(--gem-sys-typography-markdown-type-scale--h-1-line-height) * .8) !important;
    --gds-type-scale-default-wdth: calc(var(--gem-sys-typography-markdown-type-scale--h-1-font-width) * .8) !important;
    font-variation-settings: var(--gds-type-scale-default-wdth), var(--gds-type-scale-default-slnt), var(--gds-type-scale-default-rond) !important;
}

.gds-body-m .gemini-h2 {
    font-size: 16px !important;
    font-weight: calc(var(--gem-sys-typography-markdown-type-scale--h-2-font-weight) * .8) !important;
    letter-spacing: calc(var(--gem-sys-typography-markdown-type-scale--h-2-font-tracking) * .8) !important;
    line-height: calc(var(--gem-sys-typography-markdown-type-scale--h-2-line-height) * .8) !important;
    --gds-type-scale-default-wdth: calc(var(--gem-sys-typography-markdown-type-scale--h-2-font-width) * .8) !important;
    font-variation-settings: var(--gds-type-scale-default-wdth), var(--gds-type-scale-default-slnt), var(--gds-type-scale-default-rond) !important;
}

.gds-body-m .gemini-h3 {
    font-weight: calc(var(--gem-sys-typography-markdown-type-scale--h-3-font-weight) * .8) !important;
    letter-spacing: calc(var(--gem-sys-typography-markdown-type-scale--h-3-font-tracking) * .8) !important;
    line-height: calc(var(--gem-sys-typography-markdown-type-scale--h-3-line-height) * .8) !important;
    --gds-type-scale-default-wdth: calc(var(--gem-sys-typography-markdown-type-scale--h-3-font-width) * .8) !important;
    font-variation-settings: var(--gds-type-scale-default-wdth), var(--gds-type-scale-default-slnt), var(--gds-type-scale-default-rond) !important;
}

.gds-body-m .gemini-h4,
.gds-body-m .gemini-h5,
.gds-body-m .gemini-h6 {
  font-weight: calc(var(--gem-sys-typography-markdown-type-scale--h-4-font-weight) * .8) !important;
  letter-spacing: calc(var(--gem-sys-typography-markdown-type-scale--h-4-font-tracking) * .8) !important;
  line-height: calc(var(--gem-sys-typography-markdown-type-scale--h-4-line-height) * .8) !important;
  --gds-type-scale-default-wdth: calc(var(--gem-sys-typography-markdown-type-scale--h-4-font-width) * .8) !important;
  font-variation-settings: var(--gds-type-scale-default-wdth), var(--gds-type-scale-default-slnt), var(--gds-type-scale-default-rond) !important;
}

.gds-body-m .gemini-h3,
.gds-body-m .gemini-h4,
.gds-body-m .gemini-h5,
.gds-body-m .gemini-h6 {
  font-size: 14px !important;
}

.gds-body-m .gemini-prompt-hr {
    margin-top: 16px;
    margin-bottom: 20px;
}

/*
.gemini-toc-content-wrapper p {
  margin-block-start: 0.5em;
  margin-block-end: 0.5em;
}
*/

.gemini-toc-content-wrapper > :first-child { margin-top: 0; }

.gemini-toc-content-wrapper > :last-child { margin-bottom: 0; }

/* Inline Code in TOC - FIX: Force wrap */
.gemini-toc-content-wrapper .gemini-prompt-inline-code {
  white-space: pre-wrap !important;
  /* word-break: break-word !important;
  overflow-wrap: break-word !important; */
}

/* Ensure scrollbar is visible but unobtrusive in TOC code blocks */
/*
.gemini-toc-content-wrapper .code-container::-webkit-scrollbar {
  height: 6px;
}

.gemini-toc-content-wrapper .code-container::-webkit-scrollbar-thumb {
  background: rgba(255, 255, 255, 0.2);
}
*/